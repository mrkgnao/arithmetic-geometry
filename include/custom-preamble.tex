\renewcommand\qedsymbol{$\blacksquare$}

% Italicized theorem-ish objects

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem*{theorem*}{Theorem}
\renewcommand{\thetheorem}{\thesection.\arabic{theorem}}

\newtheorem{prop}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}

\newtheorem{question}[theorem]{Question}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{aside}[theorem]{Aside}
\newtheorem{erratum}{Erratum}[chapter]
\newtheorem{slogan}[theorem]{Slogan}
\renewcommand{\theslogan}{\thesection.\Alph{slogan}}

\newtheorem{example}[theorem]{Example}
\renewcommand{\theexample}{\thesection.\Alph{example}}

\newtheorem{exercise}{Exercise}[chapter]
\renewcommand{\theexercise}{\thesection.\Alph{exercise}}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

\newtheoremstyle{adjectival}{}{}{\itshape}{}{\bfseries}{.}{.5em}{\thmnote{#3 }#1 #2}
\theoremstyle{adjectival}
\newtheorem{atheorem}[theorem]{Theorem}
\newtheorem{alemma}[theorem]{Lemma}
\newtheorem{acorollary}[theorem]{Corollary}
\newtheorem{aproposition}[theorem]{Proposition}
\newtheorem{adefinition}[theorem]{Definition}

\newcommand{\mr}[1]{\br^{#1}}

\newcommand{\mrn}[0]{\mr n}
\newcommand{\mrm}[0]{\mr m}
\newcommand{\mrk}[0]{\mr k}

\newcommand{\mc}[1]{\bc^{#1}}

\newcommand{\mcn}[0]{\mc n}
\newcommand{\mcm}[0]{\mc m}
\newcommand{\mck}[0]{\mc k}

\newcommand{\shci}[1]{C^{\infty}(#1)}
\newcommand{\shcin}[0]{C^{\infty}}

\newcommand{\om}[0]{\Omega^n}
\newcommand{\omg}[1]{\Omega^{#1}}
\newcommand{\omgg}[2]{\Omega^{#1}(#2)}
\newcommand{\omo}[1]{\Omega^n(#1)}
\newcommand{\omu}[0]{\Omega^n(U)}

\newcommand{\oms}[0]{\Omega^\ast}

\newcommand{\dx}[1]{\mathnormal{d}x^{#1}}
\newcommand{\fdx}[1]{{f}_{#1}\;\mathnormal{d}x^{#1}}

\newcommand{\dxi}[0]{\dx i}
\newcommand{\dxj}[0]{\dx j}
\newcommand{\dxn}[0]{\dx n}
\newcommand{\dxI}[0]{\dx I}
\newcommand{\dxJ}[0]{\dx J}
\newcommand{\npar}{\medskip\noindent}
\newcommand{\mdr}{{{\sf{Mod}}_R}}
\newcommand{\mdg}[1]{{{\sf{Mod}}_{#1}}}

% \makeatletter
% \DeclareSymbolFont{sfoperators}{\operator@encoding}{\rmdefault}{m}{n}
% \DeclareSymbolFontAlphabet{\mathnormal}{sfoperators}
% \def\operator@font{\mathgroup\symsfoperators}
% \makeatother

\DeclareMathOperator{\tr}{{\mathnormal{tr}}}

\let\det\relax
\DeclareMathOperator{\det}{{\mathnormal{det}}}

\DeclareMathOperator{\id}{{\mathnormal{id}}}

\setlength\parindent{0pt}

\newcommand{\upperhalfplane}{\fh}

\newcommand{\sumzi}{\sum_{n=0}^\infty}
\newcommand{\sumoi}{\sum_{n=1}^\infty}

\newcommand{\Mod}[1]{\ (\mathnormal{mod}\ #1)}

\newcommand{\pfrac}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pfracr}[1]{\frac{\partial}{\partial #1}}

\DeclareMathOperator{\Spec}{Spec}

\makeatletter
\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}
\makeatother

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%

% Swap the definition of \abs* and \norm*, so that \abs
% and \norm resizes the size of the brackets, and the 
% starred version does not.
\makeatletter
\let\oldabs\abs
\def\abs{\@ifstar{\oldabs}{\oldabs*}}
%
\let\oldnorm\norm
\def\norm{\@ifstar{\oldnorm}{\oldnorm*}}
\makeatother

\newcommand{\divides}[2]{#1 \mathop{|} #2}

\newcommand{\newTerm}[1]{\emph{#1}\xspace}

\newcommand{\ringExtension}[2]{#1 \mathop{|} #2}

\newcommand{\ringExtensionA}[1]{\ringExtension{#1}{A}}
\newcommand{\ringExtensionK}[1]{\ringExtension{#1}{K}}

\newcommand{\ringExtensionBA}[0]{\ringExtension{B}{A}}
\newcommand{\ringExtensionLK}[0]{\ringExtension{L}{K}}

\newcommand{\fieldExtensionDegree}[2]{[#1 : #2]}

%
% Norms and traces
%

\newcommand{\normMapInFieldExtension}[2]{{\mathnormal{Nm}}_{\ringExtension{#1}{#2}}}
\newcommand{\normInFieldExtension}[3]{{\normMapInFieldExtension{#1}{#2}}\left(#3\right)}

\newcommand{\normMapInFieldExtensionLK}[0]{\normMapInFieldExtension{L}{K}}
\newcommand{\normInFieldExtensionLK}[1]{\normInFieldExtension{L}{K}{#1}}

\let\Nm\normInFieldExtensionLK
\let\Nmm\normMapInFieldExtensionLK
\let\Nmmg\normMapInFieldExtension

\newcommand{\traceMapInFieldExtension}[2]{{\mathnormal{Tr}}_{\ringExtension{#1}{#2}}}
\newcommand{\traceInFieldExtension}[3]{{\traceMapInFieldExtension{#1}{#2}}\left(#3\right)}

\newcommand{\traceMapInFieldExtensionLK}[0]{\traceMapInFieldExtension{L}{K}}
\newcommand{\traceInFieldExtensionLK}[1]{\traceInFieldExtension{L}{K}{#1}}

\let\Tr\traceInFieldExtensionLK
\let\Trm\traceMapInFieldExtensionLK
\let\Trmg\traceMapInFieldExtension

\newcommand{\ringOfDualNumbersOver}[1]{{#1}[\epsilon]/(\epsilon^2)}
\newcommand{\ringOfDualNumbersOverk}[0]{\ringOfDualNumbersOver{k}}
\let\dualk\ringOfDualNumbersOverk